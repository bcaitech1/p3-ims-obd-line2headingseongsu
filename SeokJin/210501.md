210501_1_my_baseline_optim.ipynb 파일으로 모델만 바꾸어가며 실험하였다. 모델은 모두 segmentation_model에 있는 것이다.

각 실험마다 인코더, 디코더, 인코더 가중치, 8에폭을 돌면서 나온 mIoU가 기록되어있다.

<details>
<summary>공통 하이퍼 파라미터</summary>
  
    N_CLASSES = 12
    batch_size = 8
    num_epochs = 8
    image_size = 256
    learning_rate = 0.0001
    model_name = 'model_test'
    random_seed = 21
    val_every = 1

    criterion = nn.CrossEntropyLoss()
    optimizer = torch.optim.Adam(params=model.parameters(), lr=learning_rate, weight_decay=1e-6)

    train_transform = A.Compose([
        A.Resize(image_size, image_size),
        A.Normalize(
            mean=(0.485, 0.456, 0.406),
            std=(0.229, 0.224, 0.225), max_pixel_value=255.0, p=1.0
        ),
        A.HorizontalFlip(),
        A.VerticalFlip(),
        A.RandomRotate90(),
        A.OneOf([
            A.MotionBlur(p=1.0),
            A.OpticalDistortion(p=1.0)
        ], p=2/3),
        ToTensorV2()
    ])

    val_transform = A.Compose([
        A.Resize(image_size, image_size),
        A.Normalize(
            mean=(0.485, 0.456, 0.406),
            std=(0.229, 0.224, 0.225), max_pixel_value=255.0, p=1.0
        ),
        ToTensorV2()
    ])

    test_transform = A.Compose([
        A.Resize(image_size, image_size),
        A.Normalize(
            mean=(0.485, 0.456, 0.406),
            std=(0.229, 0.224, 0.225), max_pixel_value=255.0, p=1.0
        ),
        ToTensorV2()
    ])

    dataset_path = '../input/data'
    anns_file_path = dataset_path + '/train.json'
    train_path = dataset_path + '/train.json'
    val_path = dataset_path + '/val.json'
    test_path = dataset_path + '/test.json'
    saved_path = './saved'
    submission_path = './submission'
    category_names = ['Background','UNKNOWN','General trash','Paper','Paper pack','Metal','Glass','Plastic','Styrofoam','Plastic bag','Battery','Clothing']

</details>

시드 고정 문제

아무리 시드를 고정하더라도 deterministic하게 바꿀 수 없는 함수가 존재해서 매 실행마다 완전히 똑같은 성능을 기대할 수는 없다. 평균적으로 0.002정도 차이가 나는 것 같다.
서로 다른 두 모델을 비교할 땐 0.004정도의 차이가 무시될 수 있다 보면 될 것 같다. 넉넉잡아 0.01정도의 차이는 무시하자. 그 이상 차이나면 모델간에 성능차이가 분명히 존재하다고 할 수 있겠다.

<details>
<summary>예시</summary>
  
    첫 번째 시도
    Epoch[1/8], Step[25/327], Loss: 1.8001
    Epoch[1/8], Step[50/327], Loss: 1.2874
    Epoch[1/8], Step[75/327], Loss: 1.0651
    Epoch[1/8], Step[100/327], Loss: 1.0220
    Epoch[1/8], Step[125/327], Loss: 0.8040
    Epoch[1/8], Step[150/327], Loss: 0.8964
    Epoch[1/8], Step[175/327], Loss: 0.6979
    Epoch[1/8], Step[200/327], Loss: 0.6790
    Epoch[1/8], Step[225/327], Loss: 0.7668
    Epoch[1/8], Step[250/327], Loss: 0.4986
    Epoch[1/8], Step[275/327], Loss: 0.5808
    Epoch[1/8], Step[300/327], Loss: 0.5706
    Epoch[1/8], Step[325/327], Loss: 0.4420
    Start validation #1
    Validation #1 mIoU: 0.3444
    두 번째 시도
    Epoch[1/8], Step[25/327], Loss: 1.7986
    Epoch[1/8], Step[50/327], Loss: 1.2883
    Epoch[1/8], Step[75/327], Loss: 1.0657
    Epoch[1/8], Step[100/327], Loss: 1.0234
    Epoch[1/8], Step[125/327], Loss: 0.7964
    Epoch[1/8], Step[150/327], Loss: 0.9032
    Epoch[1/8], Step[175/327], Loss: 0.7021
    Epoch[1/8], Step[200/327], Loss: 0.6928
    Epoch[1/8], Step[225/327], Loss: 0.7593
    Epoch[1/8], Step[250/327], Loss: 0.4945
    Epoch[1/8], Step[275/327], Loss: 0.5916
    Epoch[1/8], Step[300/327], Loss: 0.5538
    Epoch[1/8], Step[325/327], Loss: 0.4414
    Start validation #1
    Validation #1 mIoU: 0.3462
    
</details>

시드 고정은 언제 정확히 해야 하는지 몰라서 시드 고정 -> 하이퍼 파라미터 설정/데이터 로더 생성 등등 -> 시드 고정 -> 모델 생성 -> 학습 -> 시드 고정 -> 모델 생성 -> 학습 -> 시드 고정 -> 모델 생성 -> 학습 -> 반복 하였다.

segmentation_model에서 imagenet으로 초기화가 가능한 모델 중 파라미터 수가 50M 이하인 것만 일단 모두 수행해보았다.

resnest* 와 res2net* 은 DeepLabV3Plus와 조합이 안 되는 것 같다. 어떤 에러를 출력해버린다.

|encoder|decoder|time|mIoU|
|------|---|---|---|
|resnet18|DeepLabV3Plus|449.37964014703175|0.4291601452840826|
|resnet34|DeepLabV3Plus|583.1752635960001|0.4006245652968794|
|resnet50|DeepLabV3Plus|706.7310264940024|0.4432160165818095|
|resnext50_32x4d|DeepLabV3Plus|989.8281010700157|0.4633722942502894|
|timm-regnetx_002|DeepLabV3Plus|1139.8078939430416|0.41860393733529033|
|timm-regnetx_004|DeepLabV3Plus|1170.9481807129923|0.436622931140246|
|timm-regnetx_006|DeepLabV3Plus|860.6857780239079|0.44566551219045|
|timm-regnetx_008|DeepLabV3Plus|1007.142520188936|0.45035430170451884|
|timm-regnetx_016|DeepLabV3Plus|765.0524481380126|0.4667909515254158|
|timm-regnetx_032|DeepLabV3Plus|808.503647155012|0.4825021365812885|
|timm-regnetx_040|DeepLabV3Plus|899.9368225369835|0.47549429442759833|



    {'encoder': 'resnet18', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.25992999310157267, 0.3127455057493684, 0.3969756441842348, 0.4036034253436067, 0.39612861954826656, 0.3885107654782534, 0.41788185570690395, 0.4291601452840826], 'time': 449.37964014703175}
    {'encoder': 'resnet34', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.28044171418351466, 0.3501930467529993, 0.39069708443965195, 0.36254835556413717, 0.4006245652968794, 0.39903707169128066, 0.39862410024121003, 0.40224746361123365], 'time': 583.1752635960001}
    {'encoder': 'resnet50', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.29104260037827645, 0.3848181436301314, 0.4054829936173316, 0.3894121904289959, 0.4290492760805554, 0.4371052076036635, 0.4432160165818095, 0.43922349894952645], 'time': 706.7310264940024}
    {'encoder': 'resnet101', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.2984920509903086, 0.3468846996604222, 0.3735308059828401, 0.4044875687791134, 0.4360922480305982, 0.42827957120254934, 0.4273770487378135, 0.4154889853577998], 'time': 916.4620690839947}
    {'encoder': 'resnext50_32x4d', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.3388616682133834, 0.3973935417416952, 0.4221377918050292, 0.4633722942502894, 0.42885570881264656, 0.44684903048161034, 0.4511465665710093, 0.4473154627831199], 'time': 989.8281010700157}
    {'encoder': 'timm-resnest14d', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-resnest26d', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-resnest50d', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-resnest101e', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-resnest50d_4s2x40d', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-resnest50d_1s4x24d', 'decoder': 'DeepLabV3Plus', 'error': ValueError('ResNest encoders do not support dilated mode')}
    {'encoder': 'timm-res2net50_26w_4s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2net101_26w_4s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2net50_26w_6s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2net50_26w_8s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2net50_48w_2s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2net50_14w_8s', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-res2next50', 'decoder': 'DeepLabV3Plus', 'error': ValueError('Res2Net encoders do not support dilated mode')}
    {'encoder': 'timm-regnetx_002', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.2272733483750103, 0.31393052224735124, 0.3613404299581946, 0.3803617322161159, 0.40404595059748954, 0.41860393733529033, 0.41312273907292424, 0.40899207116311403], 'time': 1139.8078939430416}
    {'encoder': 'timm-regnetx_004', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.2617444621307326, 0.3408115950644144, 0.4009770846249501, 0.4002820078998211, 0.42723563301991996, 0.43434230318851824, 0.436622931140246, 0.42904293639408575], 'time': 1170.9481807129923}
    {'encoder': 'timm-regnetx_006', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.2665535584485949, 0.33424323197964134, 0.40294014210499074, 0.4229263263769264, 0.4349793157197075, 0.43317300205044035, 0.4340569670211247, 0.44566551219045], 'time': 860.6857780239079}
    {'encoder': 'timm-regnetx_008', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.261065354529321, 0.36499848947785196, 0.4059206935507001, 0.4183558798671841, 0.4441553242283019, 0.4258721556226565, 0.43442807488591095, 0.45035430170451884], 'time': 1007.142520188936}
    {'encoder': 'timm-regnetx_016', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.29847328886043617, 0.3846431611389099, 0.44875389317215447, 0.44294541761692463, 0.4488932057145702, 0.455031276607782, 0.4667909515254158, 0.4664099623632039], 'time': 765.0524481380126}
    {'encoder': 'timm-regnetx_032', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.2994611860393452, 0.39672972178563204, 0.42342136935554664, 0.46182670382679253, 0.4671079518052052, 0.4625097555312427, 0.4690238463207139, 0.4825021365812885], 'time': 808.503647155012}
    {'encoder': 'timm-regnetx_040', 'decoder': 'DeepLabV3Plus', 'mIoU': [0.34356635074785563, 0.4124416197844896, 0.44669538014462806, 0.43800281961082543, 0.46350383842136245, 0.47549429442759833, 0.4674026681350394, 0.47295198092628665], 'time': 899.9368225369835}
